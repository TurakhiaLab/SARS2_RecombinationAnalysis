# recomb-experiments

# Installation

This repository uses the `pixi` package manager. Install `pixi` if not already installed on your system with the following command.
If you already have `pixi` installed on your system, please skip to the step below to activate the `pixi` shell environment.

NOTE: This command will work for Linux & macOS installation only, please see the `pixi` installation page for windows: [install pixi](https://pixi.sh/latest/installation/).


```
curl -fsSL https://pixi.sh/install.sh | sh
```

Once `pixi` is installed on your system, activate the shell environment that contains all the necessary dependencies by running the following command:

```
pixi shell
```

# Data for SARS-CoV-2 Recombination Analysis
The following files used in the analysis are provided in the `data` directory:
- `final_recombinants_2023-12-25.txt`: The `RIVET` inferred recombination results from the "2023-12-25" private MAT.
- `trios_2023-12-25.vcf`: The VCF file for all trio recombinant sequences inferred by `RIVET`
- `genetic-diversity-gisaidAndPublic.2023-12-25.csv`: The computed standing genetic diversity scores for the "2023-12-25" private MAT.

For those interested in reproducing the `RIVET` or standing genetic diversity steps, please see the section below.


The following files used in the analysis will be automatically downloaded or generated by running the script below.
- `time_series_covid19_confirmed_global.csv`: The JHU SARS-CoV-2 global daily cumulative confirmed case count data.
- `mutations.tsv`: Contains the individual amino acid mutations fitness scores from the PyR0 model, ranked by statistical significance.
- `chronumental_dates_gisaidAndPublic.2023-12-25-STEPS2000-SERIAL3.metadata.tsv.tsv`: The Chronumental-inferred emergence dates for all samples in the MAT.


### Run the following command to get all data required for this analysis
```
pixi run data
```


### Recombination Inference and Standing Genetic Diversity Data
The configuration YAML file, `config.yaml` contains the names of data files required for this analysis.

A private MAT (dated "2023-12-25") was used for the analysis in this manuscript, however the full analysis is completely compatible with the publically available MATs that can be downloaded here: [https://hgdownload.soe.ucsc.edu/goldenPath/wuhCor1/UShER_SARS-CoV-2/](https://hgdownload.soe.ucsc.edu/goldenPath/wuhCor1/UShER_SARS-CoV-2/). 
To reproduce this analysis with a publically available MAT, replace relevant fields in the `config.yaml` file with the correct name and date of the MAT and metadata files used.


To re-run the recombination inference or standing genetic diversity steps, change the corresponding field to `True` in the `config.yaml` file, and rerun `pixi run data`.

NOTE: The `RIVET` step could take several hours to complete depending on the size of the MAT, and the standing genetic diversity results could take several days to complete, for a MAT with millions of sequences.

```
# Decide which steps to rerun
RERUN_CHRONUMENTAL: True
RERUN_FITNESS: True
RERUN_RIVET: False
RERUN_GENETIC_DIVERSITY: False
```

Generate the data:
```
pixi run data
```


# Analysis Notebook
Run the following two commands to launch the `notebooks/analysis.ipynb` notebook.
```
# if not already in pixi shell, run `pixi shell` command first
pixi run jupyter lab notebooks/analysis.ipynb
```

