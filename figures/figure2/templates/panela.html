<!doctype html>
<html lang="en">
  <head>
    <title>Figure 2a</title>
    <meta charset="utf-8" />
  </head>

  <body>
    <script src="https://cdn.jsdelivr.net/npm/d3@7"></script>
    <button id="downloadButton" type="submit" value="Submit">
      Download SVG
    </button>

    <div id="bubbleChart"></div>

    <script type="module">
      import { bubblePlot } from "./static/bubblePlot.js";
      import { downloadSVG } from "./static/util.js";

      const bubbleScalingColor = function (size) {
        if (size < 50) {
          return "gray";
        } else if (size >= 50 && size < 500) {
          return "green";
        } else if (size >= 500 && size < 3000) {
          return "orange";
        } else if (size >= 3000 && size < 50000) {
          return "red";
        } else if (size >= 50000) {
          return "purple";
        }
      };

      const config = {
        divID: "#bubbleChart",

        // Chart data
        filename: "static/data/rivet_recombs_data.csv",
        statsFilename: "static/data/monthly_fitness_stats.csv",

        // Main Plot Data
        x: "Month",
        y: "LogScore",
        r: "UShERClusterSize",

        // Statistics add for additional curves
        mean: "LogMean",
        max: "LogMax",
        median: "LogMedian",
        percentile99: "LogPercentile99",
        percentile90: "LogPercentile90",
        percentile9999: "LogPercentile9999",

        // Plot axis settings
        axisTickLabelSize: "15",
        axisTitleSize: "25px",
        // Axis Titles
        yAxisTitle: "Fitness R/RA (log)",
        xAxisTitle: "Month",

        // Plotting settings and statistics
        bubbleColoringCallable: bubbleScalingColor,
        averageCurve: true,
        maxCurve: false,
        medianCurve: false,
        shadeArea: true,

        // Config for the figure legend
        legend: true,
        legendLabels: [
          "less than 50 descendants",
          "between 50 and 500 descendants",
          "between 500 and 3000 descendants",
          "between 3000 and 20000 descendants",
          "greater than 50000 descendants",
        ],
        legendColors: ["gray", "green", "orange", "red", "purple"],

        // Legend Positioning
        legendCX: 35,
        legendCY: 60,
        legendXAttr: 55,
        legendYAttr: 57,
        legendFontSize: "16px",

        // Plot Interactivity settings
        toolTip: { div: "#bubble" },

        // Plot dimensions
        margin: { top: 100, right: 200, bottom: 150, left: 150 },
        width: 1800,
        height: 900,
      };

      const width = config["width"];
      const height = config["height"];
      const margin = config["margin"];

      let selection = d3.select(config["divID"]).append("div");
      let svg = selection
        .append("svg")
        .attr("width", width + margin.left + margin.right)
        .attr("height", height + margin.top + margin.bottom)
        .append("g")
        .attr("transform", "translate(" + margin.left + "," + margin.top + ")");

      // Graph for fitness of RIVET-inferred recombinants over time
      bubblePlot(svg, config);

      // Download button for plot svg
      const svgFilename = "figure2a.svg";
      document
        .getElementById("downloadButton")
        .addEventListener("click", () => {
          downloadSVG(svg, svgFilename);
        });
    </script>
  </body>
</html>
